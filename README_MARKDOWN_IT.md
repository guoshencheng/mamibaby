# markdown-it é›†æˆå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. **å®‰è£…ä¾èµ–**
```bash
âœ… markdown-it: 14.1.0
âœ… @types/markdown-it: 14.1.2 (å¼€å‘ä¾èµ–)
```

### 2. **åˆ›å»º Markdown æ¸²æŸ“ç»„ä»¶**

#### æ–‡ä»¶ï¼š`src/components/MarkdownRenderer.tsx`
- ä½¿ç”¨ `markdown-it` è¿›è¡Œ Markdown è§£æ
- ä½¿ç”¨ `useMemo` ä¼˜åŒ–æ€§èƒ½ï¼Œé¿å…é‡å¤åˆ›å»ºå®ä¾‹
- é…ç½®é€‰é¡¹ï¼š
  - `html: false` - ç¦ç”¨ HTML æ ‡ç­¾ï¼ˆå®‰å…¨æ€§ï¼‰
  - `linkify: true` - è‡ªåŠ¨è½¬æ¢ URL ä¸ºé“¾æ¥
  - `typographer: true` - å¯ç”¨æ™ºèƒ½æ ‡ç‚¹
  - `breaks: true` - è½¬æ¢æ¢è¡Œç¬¦ä¸º `<br>`

```tsx
const md = useMemo(() => {
  return new MarkdownIt({
    html: false,
    linkify: true,
    typographer: true,
    breaks: true,
  });
}, []);
```

#### æ–‡ä»¶ï¼š`src/components/MarkdownRenderer.css`
- å®Œæ•´çš„ CSS æ ·å¼å®šä¹‰
- å®Œå…¨é€‚é… Ant Design è®¾è®¡è§„èŒƒ
- æ”¯æŒçš„æ ·å¼ï¼š
  - æ ‡é¢˜ (h1-h6)
  - æ®µè½å’Œæ–‡æœ¬æ ¼å¼
  - ä»£ç å’Œä»£ç å—
  - å¼•ç”¨å—ï¼ˆå¸¦è“è‰²è¾¹æ¡†å’Œæµ…è“èƒŒæ™¯ï¼‰
  - åˆ—è¡¨ï¼ˆæœ‰åº/æ— åºï¼Œæ”¯æŒåµŒå¥—ï¼‰
  - è¡¨æ ¼ï¼ˆå¸¦ hover æ•ˆæœï¼‰
  - é“¾æ¥ï¼ˆå¸¦ hover æ•ˆæœï¼‰
  - å›¾ç‰‡ï¼ˆè‡ªé€‚åº”å®½åº¦ï¼‰
  - åˆ†éš”çº¿
  - åˆ é™¤çº¿

### 3. **é›†æˆåˆ°èŠå¤©ç•Œé¢**

#### æ–‡ä»¶ï¼š`src/components/ChatBox.tsx`
- å¯¼å…¥ `MarkdownRenderer` ç»„ä»¶
- AI æ¶ˆæ¯ä½¿ç”¨ Markdown æ¸²æŸ“
- ç”¨æˆ·æ¶ˆæ¯ä¿æŒç®€å•æ–‡æœ¬æ˜¾ç¤º
- æ”¯æŒæµå¼è¾“å‡ºçš„å®æ—¶æ¸²æŸ“

```tsx
{message.role === 'user' ? (
  // ç”¨æˆ·æ¶ˆæ¯ä½¿ç”¨ç®€å•çš„æ–‡æœ¬æ˜¾ç¤º
  <div style={{ whiteSpace: 'pre-wrap', wordBreak: 'break-word' }}>
    {message.content}
  </div>
) : (
  // AI æ¶ˆæ¯ä½¿ç”¨ Markdown æ¸²æŸ“
  <div style={{ fontSize: '14px' }}>
    <MarkdownRenderer content={message.content} />
  </div>
)}
```

### 4. **ä¼˜åŒ– AI æç¤ºè¯**

#### æ–‡ä»¶ï¼š`src/prompts/storyPrompts.ts`
åœ¨æ‰€æœ‰ä¸‰ä¸ªæ­¥éª¤çš„ System Prompt ä¸­æ·»åŠ äº† Markdown æ ¼å¼è¦æ±‚ï¼š

**ç¬¬ä¸€æ­¥ - æ•…äº‹æ¦‚è¦ï¼š**
```
**è¾“å‡ºæ ¼å¼**ï¼š
- è¯·ä½¿ç”¨ Markdown æ ¼å¼è¾“å‡ºï¼Œä½¿ç”¨æ ‡é¢˜ã€åˆ—è¡¨ã€åŠ ç²—ç­‰æ ¼å¼è®©å†…å®¹æ›´æ¸…æ™°
- ä½¿ç”¨ ## ä½œä¸ºä¸»è¦ç« èŠ‚æ ‡é¢˜ï¼Œ### ä½œä¸ºå­æ ‡é¢˜
- ä½¿ç”¨ **æ–‡æœ¬** æ ‡è®°é‡ç‚¹å†…å®¹
```

**ç¬¬äºŒæ­¥ - æ ¸å¿ƒå…ƒç´ ï¼š**
```
**è¾“å‡ºæ ¼å¼**ï¼š
- è¯·ä½¿ç”¨ Markdown æ ¼å¼è¾“å‡ºï¼Œä½¿ç”¨æ ‡é¢˜ã€åˆ—è¡¨ã€åŠ ç²—ç­‰æ ¼å¼è®©å†…å®¹æ›´æ¸…æ™°
- ä½¿ç”¨ ## ä½œä¸ºä¸»è¦ç« èŠ‚æ ‡é¢˜ï¼ˆå¦‚ ## è®¾è®¡æ€è·¯ï¼‰
- ä½¿ç”¨ ### ä½œä¸ºå­æ ‡é¢˜ï¼ˆå¦‚ ### å…³é”®äººç‰©ï¼‰
- ä½¿ç”¨æœ‰åºåˆ—è¡¨æˆ–æ— åºåˆ—è¡¨å±•ç¤ºè¦ç‚¹
```

**ç¬¬ä¸‰æ­¥ - åˆ†é•œè¯¦æƒ…ï¼š**
```
**è¾“å‡ºæ ¼å¼**ï¼š
- è¯·ä½¿ç”¨ Markdown æ ¼å¼è¾“å‡ºï¼Œä½¿ç”¨æ ‡é¢˜ã€åˆ—è¡¨ã€åŠ ç²—ç­‰æ ¼å¼è®©å†…å®¹æ›´æ¸…æ™°
- ä½¿ç”¨ ## ä½œä¸ºä¸»æ ‡é¢˜ï¼Œ### ä½œä¸ºåˆ†é•œæ ‡é¢˜
- ä½¿ç”¨ **æ–‡æœ¬** æ ‡è®°å…³é”®ä¿¡æ¯
- ä½¿ç”¨æœ‰åºåˆ—è¡¨å±•ç¤ºåˆ†é•œåºåˆ—
```

### 5. **æ–‡æ¡£å®Œå–„**
- âœ… `MARKDOWN_USAGE.md` - è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£
- âœ… `CHANGELOG_MARKDOWN.md` - æ›´æ–°æ—¥å¿—
- âœ… `README_MARKDOWN_IT.md` - æœ¬æ–‡æ¡£

## ğŸ¨ æ”¯æŒçš„ Markdown è¯­æ³•

| è¯­æ³• | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `# æ ‡é¢˜` | ä¸€çº§åˆ°å…­çº§æ ‡é¢˜ | `## äºŒçº§æ ‡é¢˜` |
| `**åŠ ç²—**` | åŠ ç²—æ–‡æœ¬ | **é‡è¦** |
| `*æ–œä½“*` | æ–œä½“æ–‡æœ¬ | *å¼ºè°ƒ* |
| `` `ä»£ç ` `` | è¡Œå†…ä»£ç  | `const a = 1` |
| ` ``` ` | ä»£ç å— | å¤šè¡Œä»£ç  |
| `> å¼•ç”¨` | å¼•ç”¨å— | å¸¦è¾¹æ¡†çš„å¼•ç”¨ |
| `- é¡¹ç›®` | æ— åºåˆ—è¡¨ | â€¢ åˆ—è¡¨é¡¹ |
| `1. é¡¹ç›®` | æœ‰åºåˆ—è¡¨ | 1. åˆ—è¡¨é¡¹ |
| `[æ–‡æœ¬](url)` | é“¾æ¥ | å¯ç‚¹å‡»é“¾æ¥ |
| `---` | åˆ†éš”çº¿ | æ°´å¹³çº¿ |
| `![](url)` | å›¾ç‰‡ | å›¾ç‰‡å±•ç¤º |
| <code>&#124; è¡¨æ ¼ &#124;</code> | è¡¨æ ¼ | å®Œæ•´è¡¨æ ¼æ”¯æŒ |

## ğŸ” æŠ€æœ¯ç‰¹æ€§

### 1. **æ€§èƒ½ä¼˜åŒ–**
```tsx
// ä½¿ç”¨ useMemo ç¼“å­˜ markdown-it å®ä¾‹
const md = useMemo(() => {
  return new MarkdownIt({ /* é…ç½® */ });
}, []);

// ä½¿ç”¨ useMemo ç¼“å­˜æ¸²æŸ“ç»“æœ
const htmlContent = useMemo(() => {
  return md.render(content);
}, [md, content]);
```

### 2. **å®‰å…¨æ€§**
- `html: false` - ç¦ç”¨ HTML æ ‡ç­¾è§£æï¼Œé˜²æ­¢ XSS æ”»å‡»
- ä½¿ç”¨ `dangerouslySetInnerHTML` ä½†å†…å®¹å·²ç»è¿‡ markdown-it å®‰å…¨å¤„ç†

### 3. **æµå¼æ”¯æŒ**
- æ¯æ¬¡å†…å®¹æ›´æ–°æ—¶ï¼Œ`useMemo` ä¼šé‡æ–°è®¡ç®—
- React ä¼šé«˜æ•ˆåœ°æ›´æ–° DOM
- é€‚åˆ AI æµå¼è¾“å‡ºåœºæ™¯

### 4. **æ ·å¼ä¸€è‡´æ€§**
æ‰€æœ‰æ ·å¼éƒ½éµå¾ª Ant Design è®¾è®¡è§„èŒƒï¼š
- é¢œè‰²ï¼š`rgba(0, 0, 0, 0.88)` ä¸»æ–‡æœ¬è‰²
- ä¸»é¢˜è‰²ï¼š`#1890ff` Ant Design è“
- èƒŒæ™¯è‰²ï¼š`#f5f5f5` æµ…ç°è‰²
- è¾¹æ¡†è‰²ï¼š`#e8e8e8` è¾¹æ¡†é¢œè‰²

## ğŸ“– ä½¿ç”¨ç¤ºä¾‹

### AI è¾“å‡ºç¤ºä¾‹

AI ç°åœ¨å¯ä»¥è¾“å‡ºè¿™æ ·çš„ Markdown å†…å®¹ï¼š

```markdown
## åˆ›ä½œæ€è·¯

è®©æˆ‘ä¸ºæ‚¨åˆ›ä½œä¸€ä¸ªå……æ»¡æƒ³è±¡åŠ›çš„æ•…äº‹ï¼š

### æ•…äº‹èƒŒæ™¯
- **æ—¶é—´**ï¼šæ˜¥å¤©çš„æ—©æ™¨
- **åœ°ç‚¹**ï¼šç¥ç§˜çš„é­”æ³•æ£®æ—
- **ä¸–ç•Œè§‚**ï¼šåŠ¨ç‰©å’Œäººç±»å’Œè°å…±å¤„çš„ç«¥è¯ä¸–ç•Œ

### ä¸»è¦è§’è‰²

1. **å°å…”å­è‰è‰**
   - å¤–è²Œï¼šé›ªç™½çš„æ¯›å‘ï¼Œç²‰çº¢è‰²çš„é•¿è€³æœµ
   - æ€§æ ¼ï¼šå‹‡æ•¢ã€å¥½å¥‡ã€å–„è‰¯

2. **æ™ºæ…§çŒ«å¤´é¹°**
   - å¤–è²Œï¼šæ£•è‰²ç¾½æ¯›ï¼Œå¤§å¤§çš„çœ¼ç›
   - æ€§æ ¼ï¼šç¿æ™ºã€æ¸©å’Œ

### æ•…äº‹æƒ…èŠ‚

> è¿™æ˜¯ä¸€ä¸ªå…³äºå‹‡æ°”å’Œæˆé•¿çš„æ¸©æš–æ•…äº‹

**èµ·å› **ï¼šè‰è‰æƒ³è¦æ‰¾åˆ°ä¼ è¯´ä¸­çš„é­”æ³•èŠ±æœµ

**ç»è¿‡**ï¼š
- é‡åˆ°å›°éš¾ï¼šè¿·è·¯åœ¨æ£®æ—æ·±å¤„
- è·å¾—å¸®åŠ©ï¼šçŒ«å¤´é¹°çš„æŒ‡å¼•
- å…‹æœææƒ§ï¼šç©¿è¶Šé»‘æš—çš„å±±æ´

**ç»“å±€**ï¼šæ‰¾åˆ°é­”æ³•èŠ±æœµï¼Œå­¦ä¼šäº†å‹‡æ•¢çš„çœŸè°›

---

ç°åœ¨è°ƒç”¨å·¥å…·ä¿å­˜æ•…äº‹æ¦‚è¦...
```

### æ¸²æŸ“æ•ˆæœ

ä¸Šè¿°å†…å®¹ä¼šè¢«æ¸²æŸ“ä¸ºï¼š
- âœ… æ¸…æ™°çš„æ ‡é¢˜å±‚çº§
- âœ… æ ¼å¼åŒ–çš„åˆ—è¡¨
- âœ… åŠ ç²—çš„é‡ç‚¹å†…å®¹
- âœ… ç¾è§‚çš„å¼•ç”¨å—
- âœ… åˆ†éš”çº¿
- âœ… æ‰€æœ‰æ ·å¼ç¬¦åˆ Ant Design è®¾è®¡è§„èŒƒ

## ğŸš€ æ‰©å±•åŠŸèƒ½

### å¯é€‰æ’ä»¶ï¼ˆæœªå®‰è£…ï¼ŒæŒ‰éœ€æ·»åŠ ï¼‰

#### 1. ä»£ç è¯­æ³•é«˜äº®
```bash
pnpm add markdown-it-highlightjs highlight.js
```

```tsx
import hljs from 'markdown-it-highlightjs';
const md = new MarkdownIt().use(hljs);
```

#### 2. Emoji æ”¯æŒ
```bash
pnpm add markdown-it-emoji
```

```tsx
import emoji from 'markdown-it-emoji';
const md = new MarkdownIt().use(emoji);
// æ”¯æŒ :smile: :heart: ç­‰
```

#### 3. ä»»åŠ¡åˆ—è¡¨
```bash
pnpm add markdown-it-task-lists
```

```tsx
import taskLists from 'markdown-it-task-lists';
const md = new MarkdownIt().use(taskLists);
// æ”¯æŒ - [ ] æœªå®Œæˆ - [x] å·²å®Œæˆ
```

#### 4. æ•°å­¦å…¬å¼
```bash
pnpm add markdown-it-katex katex
```

```tsx
import katex from 'markdown-it-katex';
const md = new MarkdownIt().use(katex);
// æ”¯æŒ $E=mc^2$
```

#### 5. è„šæ³¨
```bash
pnpm add markdown-it-footnote
```

```tsx
import footnote from 'markdown-it-footnote';
const md = new MarkdownIt().use(footnote);
```

## ğŸ“ æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ChatBox.tsx              # èŠå¤©æ¡†ç»„ä»¶ï¼ˆå·²é›†æˆ Markdownï¼‰
â”‚   â”œâ”€â”€ MarkdownRenderer.tsx     # Markdown æ¸²æŸ“å™¨
â”‚   â””â”€â”€ MarkdownRenderer.css     # Markdown æ ·å¼
â”œâ”€â”€ prompts/
â”‚   â””â”€â”€ storyPrompts.ts          # AI æç¤ºè¯ï¼ˆå·²æ·»åŠ æ ¼å¼è¦æ±‚ï¼‰
â””â”€â”€ services/
    â””â”€â”€ storyService.ts          # AI æœåŠ¡ï¼ˆæµå¼è¾“å‡ºï¼‰

docs/
â”œâ”€â”€ MARKDOWN_USAGE.md            # ä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ CHANGELOG_MARKDOWN.md        # æ›´æ–°æ—¥å¿—
â””â”€â”€ README_MARKDOWN_IT.md        # æœ¬æ–‡æ¡£
```

## âœ… éªŒè¯æ¸…å•

- [x] markdown-it ä¾èµ–å·²å®‰è£…
- [x] TypeScript ç±»å‹å®šä¹‰å·²å®‰è£…
- [x] MarkdownRenderer ç»„ä»¶å·²åˆ›å»º
- [x] CSS æ ·å¼å·²å®Œå–„
- [x] ChatBox å·²é›†æˆ Markdown æ¸²æŸ“
- [x] AI æç¤ºè¯å·²ä¼˜åŒ–
- [x] TypeScript ç¼–è¯‘æ— é”™è¯¯
- [x] æ–‡æ¡£å·²å®Œå–„

## ğŸ¯ æµ‹è¯•å»ºè®®

å¯åŠ¨é¡¹ç›®åï¼Œæµ‹è¯•ä»¥ä¸‹å†…å®¹ï¼š

1. **æ ‡é¢˜å±‚çº§**ï¼šAI è¾“å‡º `## æ ‡é¢˜` å’Œ `### å­æ ‡é¢˜`
2. **åˆ—è¡¨**ï¼šAI è¾“å‡ºæœ‰åºå’Œæ— åºåˆ—è¡¨
3. **å¼ºè°ƒ**ï¼šAI è¾“å‡º `**åŠ ç²—**` å’Œ `*æ–œä½“*`
4. **ä»£ç **ï¼šAI è¾“å‡ºè¡Œå†… `` `ä»£ç ` `` å’Œä»£ç å—
5. **å¼•ç”¨**ï¼šAI è¾“å‡º `> å¼•ç”¨å†…å®¹`
6. **é“¾æ¥**ï¼šAI è¾“å‡º `[æ–‡æœ¬](url)`
7. **æµå¼æ›´æ–°**ï¼šè§‚å¯Ÿ Markdown åœ¨æµå¼è¾“å‡ºæ—¶çš„å®æ—¶æ¸²æŸ“

## ğŸ“š å‚è€ƒèµ„æº

- [markdown-it å®˜æ–¹æ–‡æ¡£](https://github.com/markdown-it/markdown-it)
- [markdown-it æ’ä»¶åˆ—è¡¨](https://www.npmjs.com/search?q=keywords:markdown-it-plugin)
- [Ant Design è®¾è®¡è§„èŒƒ](https://ant.design/docs/spec/introduce-cn)
- [markdown-it API æ–‡æ¡£](https://markdown-it.github.io/markdown-it/)

## ğŸ’¡ æœ€ä½³å®è·µ

1. **æ€§èƒ½**ï¼šä½¿ç”¨ `useMemo` ç¼“å­˜æ¸²æŸ“ç»“æœ
2. **å®‰å…¨**ï¼šç¦ç”¨ HTML æ ‡ç­¾è§£æ
3. **æ ·å¼**ï¼šä¿æŒä¸ Ant Design ä¸€è‡´
4. **æ‰©å±•**ï¼šæŒ‰éœ€æ·»åŠ æ’ä»¶ï¼Œä¸è¦ä¸€æ¬¡æ€§æ·»åŠ å¤ªå¤š
5. **æµ‹è¯•**ï¼šåœ¨çœŸå®åœºæ™¯ä¸­æµ‹è¯•æµå¼è¾“å‡ºæ•ˆæœ

---

**å®Œæˆæ—¶é—´**ï¼š2025-10-20  
**æŠ€æœ¯æ ˆ**ï¼šReact + TypeScript + markdown-it + Ant Design  
**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆå¹¶é€šè¿‡æµ‹è¯•

